<!DOCTYPE html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="static/css/main.css">
    <link rel="icon" href="/static/image/favicon.png" type="image/gif" sizes="16x16">
    {#    add#}
    {#     <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"#}
    {#          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">#}
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!---------------------enxi's weather links---------------------------->
    <script src={{ url_for('static',filename='js/jquery-3.3.1.min.js') }} type="text/javascript"></script>

    <!--------------------------------------------------------------------->
</head>
<body>
<!--nav bar-->
<header class="header" id="header">
    <!--nav bar image-->
    <img src="static/image/Banniere.png" alt="Banner" width="100%" height="10%">
    <!--Nav Bar List-->
    <div class="nav" id="nav">
        <ul>
            <li class="index"><a href="index">Home</a></li>
            <li class="stations"><a href="stations">Stations</a>
            <li class="getting-started"><a href="getting-started">Getting Started</a></li>
            <li class="contact"><a href="contact">Contact</a></li>
        </ul>
    </div>
</header>
<!--nav bar end-->

<!--main body of content-->

<div class="whitebkgnd" id="whitebkgnd">

    <div id="search_date" style="position: relative;">
        <input type="date" name="date" id="date_weather_forcast">
        <select id="time_weather_forcast" style="display: block" name="time">
            <option value='06:00:00'>06:00:00</option>
            <option value='09:00:00'>09:00:00</option>
            <option value='12:00:00'>12:00:00</option>
            <option value='15:00:00'>15:00:00</option>
            <option value='18:00:00'>18:00:00</option>
            <option value='21:00:00'>21:00:00</option>
            <option value='00:00:00'>00:00:00</option>
            <option value='03:00:00'>03:00:00</option>
        </select>
        <button onclick="display()" type="button">Show forecast</button>
        <div id="show_forecast">
        </div>
    </div>
    <div>
        {#        <div id="map" class="map"></div>#}
        <div id="weather_box" style="border: #5f788a solid;width: 16%; margin: 0 auto;padding: 0;position: relative;
     z-index: 99;margin-right: 10%; color: white; text-shadow: black;  position: absolute; right: 0; font-size: 20px;">

        </div>


        <!--Enxi bike begin-->
        <div id="bike_prediction">
            <select id="forecast_time" style="display: block; " name="time">
                <option value='06:00:00'>06:00:00</option>
                <option value='09:00:00'>09:00:00</option>
                <option value='12:00:00'>12:00:00</option>
                <option value='15:00:00'>15:00:00</option>
                <option value='18:00:00'>18:00:00</option>
                <option value='21:00:00'>21:00:00</option>
                <option value='00:00:00'>00:00:00</option>
                <option value='03:00:00'>03:00:00</option>
            </select>
            <select id="station_list" style="display: block">
            </select>
            <button onclick="get_prediction()" type="button">Show Bikes Prediction</button>
            <p id="available_bikes"></p>
        </div>
        <!--Enxi bike end-->

        <div id="root"></div>
    </div>
</div>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    <script type="text/javascript">
        {#var map;#}
        {##}
        {#function initMap() {#}
        {#    map = new#}
        {#    google.maps.Map(document.getElementById('map'), {#}
        {#        center: {lat: 53.350140, lng: -6.266155},#}
        {#        zoom: 11#}
        {#    });#}


        const app = document.getElementById('root');

        $.ajax({
            url: 'http://api.openweathermap.org/data/2.5/weather?appid=ae679d7b6212a1a3daf681d0d843aa83&q=Dublin&units=metric',
            type: "GET",
            dataType: "jsonp",
            jsonpCallback: "jsonp",
            success: function (data) {

                let widget = "<h3 style='padding-top:5px; font-size: 20px'><strong>Current weather</strong>  </h3>" +
                    "<img src = 'http://openweathermap.org/img/w/" + data.weather[0].icon + ".png' > " + data.weather[0].description +


                    "<h3 style='text-align: center;border-bottom:thick double black; padding-bottom: 5%; font-size: 15px'>" + data.main.temp + "&deg;C</h3>" + "</hr>" +

                    "<h3 style='padding-top:5px; font-size: 15px'>Humidity levels at: " + data.main.humidity + " %</h3>" +

                    "<h3 style='padding-top:5px; font-size: 15px'>Winds at: " + data.wind.speed + " m/s</h3>"
                document.getElementById("weather_box").innerHTML = widget;

            }
        })


    </script>

    <script type="text/javascript">

        function display() {
            var date = $("#date_weather_forcast").val();
            var time = $("#time_weather_forcast").val();

            if (date != '' && time != '') {
                $.ajax({
                    url: 'http://api.openweathermap.org/data/2.5/forecast?appid=ae679d7b6212a1a3daf681d0d843aa83&q=Dublin&units=metric',
                    type: "GET",
                    dataType: "jsonp",
                    jsonpCallback: "jsonp",
                    success: function (data) {
                        var a = 0;
                        for (var i = 0; i < data.list.length; i++) {
                            if (data.list[i].dt_txt == date + ' ' + time) {

                                let fore = "<img src = 'http://openweathermap.org/img/w/" + data.list[i].weather[0].icon + ".png' > " + data.list[i].weather[0].description +

                                    "<h3 style='text-align: center;border-bottom:thick double black; padding-bottom: 10%'>" + data.list[i].main.temp + "&deg;C</h3>" + "</hr>" +
                                    "<h3 style='padding-top:5px; font-size: 110%'>Humidity levels at: " + data.list[i].main.humidity + " %</h3>" +
                                    "<h3 style='padding-top:5px; font-size: 110%'>Winds at: " + data.list[i].wind.speed + " m/s</h3>"
                                document.getElementById("show_forecast").innerHTML = fore;
                                var a = 1;
                            }

                        }
                        if (a == 0) {
                            alert("Error");
                        }

                    }
                });
            }
        }

        /*Enxi bike begin*/

        var station_json ={{ stations_json | tojson }};
        let content = "";
        for (let i = 0; i < station_json.length; i++) {
            content += "<option value=" + station_json[i].number + ">" + station_json[i].name + "</option>"
        }
        document.getElementById('station_list').innerHTML = content;

        function get_prediction() {
            var time_hour = parseInt(document.getElementById('forecast_time').value.slice(0, 2));
            var station_id = parseInt(document.getElementById('station_list').value);
            $.get("/bikes_prediction?time_hour=" + time_hour + "&station_id=" + station_id, function (data, status) {
                    document.getElementById("available_bikes").innerHTML = "Number of available bikes: " + data;
                }
            )
        };
        /*Enxi bike end*/

    </script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key={{ MAPS_APIKEY }}
&amp;callback=initMap"
            type="text/javascript">


    </script>


</div>

<h3>
    Dublin Bikes
</h3>
{#<div id='map'></div>#}
<div id="root"></div>

<div class="row">
    <div class="input-field col s3">
        <input placeholder="1" id="station_filter" type="text" class="validate">
        <label for="station_filter">Station Filter</label>
    </div>
    <button onclick="look_up()">Lookup</button>
</div>

<script>
    function look_up() {
        var station_id = document.getElementById("station_filter").value;
        console.log(station_id);
        $.ajax({
            url: "/station_id",
            data: {'station_id': station_id},
            dataType: 'json',
            type: 'POST',
            success: function (station) {
                var station = station
                var new_div = `<div class="col s6 m4">
      <div class="card blue-grey darken-1">
        <center><span class="card-title white-text">Station ID: ` + station.StationID + `</span></center>
        <div class="card-content white-text">
          <p>Address: ` + station.address + `<p>
          <p>Total Bike Stands: ` + station.bike_stands + `<p>
          <p>Avaliable Bike Stands: ` + station.available_bike_stands + `<p>
          <p>Avaliable Bikes: ` + station.available_bikes + `<p>
        </div>
        
      </div>
    </div>`;
                console.log(new_div);
                $('#station_details').html(new_div);
            }
        });
    }
</script>

<div id="station_details" class="row">
    {% for station in stations %}
        <div class="col s6 m4">
            <div class="card blue-grey darken-1">
                <center><span class="card-title white-text">Station ID: {{ station.StationID }}</span></center>
                <div class="card-content white-text">
                    <p>Address: {{ station.address }}<p>
                    <p>Total Bike Stands: {{ station.bike_stands }}<p>
                    <p>Avaliable Bike Stands: {{ station.available_bike_stands }}<p>
                    <p>Avaliable Bikes: {{ station.available_bikes }}<p>
                </div>

            </div>
        </div>


    {% endfor %}
</div>


{#    <script type="text/javascript">#}
{#        var map;#}
{#        function initMap() {#}
{#            map=new#}
{#         google.maps.Map(document.getElementById('map'), {#}
{#    center: {lat: 53.350140, lng: -6.266155},#}
{#    zoom: 11#}
{#  });#}



<script type="text/javascript"
        src="https://www.gstatic.com/charts/loader.js"></script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key={{ MAPS_APIKEY }}
&amp;callback=initMap"
        type="text/javascript">
</script>


<script src="static/js/main.js"></script>
</body>
</html>